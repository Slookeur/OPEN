\newpage
\newcommand{\abuild}{\bftt{appimage-builder}}
\newcommand{\pbuild}{\bftt{pkg2appimage}}

\section{Appimage}

\href{https://appimage.org/}{AppImage} is an open-source format for distributing portable software on Linux.  
It aims to allow the installation of programs independently of specific Linux distributions, a concept often referred to as upstream packaging. \\
As a result, an AppImage can be installed and run across \href{https://ubuntu.com}{Ubuntu}, \href{https://archlinux.org}{Arch Linux}, and \href{https://www.redhat.com}{Red Hat Enterprise Linux} without needing to use specific files. 
The AppImage is a format that's self-contained, rootless, and independent of the underlying Linux distribution. 

\subsection{Prerequesites}

Give a look to the following tutorials:
\begin{itemize}
\item \href{https://docs.appimage.org/}{https://docs.appimage.org/}
\item \href{https://docs.appimage.org/packaging-guide/index.html}{https://docs.appimage.org/packaging-guide/index.html}
\item \href{https://appimage-builder.readthedocs.io/en/latest/}{https://appimage-builder.readthedocs.io/en/latest/}
\item \href{https://github.com/AppImage/AppImageKit/wiki/Creating-AppImages/cc2441518975caca23e9ce2dba6f08a22c678d1e}{Creating appimage}
\item \href{https://docs.appimage.org/packaging-guide/converting-binary-packages/pkg2appimage.html}{https://docs.appimage.org/packaging-guide/converting-binary-packages/pkg2appimage.html}
\end{itemize}
\vspace{0.25cm}
To create an appimage of your program, you can work using either using:
\vspace{0.25cm}
\begin{itemize}

\item \abuild\ that you can install using:
{\notsoscript{
\begin{scripti}
\bftt{wget} \dgtt{-O} appimage-builder-x86\_64.AppImage \textbackslash
https://github.com/AppImageCrafters/appimage-builder/releases/download/v1.1.0/appimage-builder-1.1.0-x86\_64.AppImage

# make executable
\bftt{chmod} \dgtt{+x} appimage-builder-x86\_64.AppImage

# install in PATH to make it available as command (optional)
\rtt{sudo} \bftt{mv} appimage-builder-x86\_64.AppImage /usr/local/bin/appimage-builder
\end{scripti}
}}
\item \pbuild\ that you can install using:
{\notsoscript{
\begin{scripti}
\bftt{wget} -c \$(wget -q https://api.github.com/repos/AppImageCommunity/pkg2appimage/releases \textbackslash
-O - | grep "pkg2appimage-.*-x86\_64.AppImage" | grep browser\_download\_url | head -n 1 | cut -d '"' -f 4) \textbackslash

# make executable
\bftt{chmod} \dgtt{+x} ./pkg2appimage-*.AppImage

# install in PATH to make it available as command (optional)
\rtt{sudo} \bftt{mv} pkg2appimage-*.AppImage /usr/local/bin/pkg2appimage
\end{scripti}
}}
\end{itemize}

\newpage
\subsection{\abuild}

To build an appimage using \abuild\ requires to prepare a recipe in a JSON file. \\
Several methods are available to let \abuild\ know how to retreive your program's data to build the appimage. 

\subsubsection*{Recipe using a local build of your program}

\begin{itemize}
\item Configure and build the program with the installation prefix set to "\texttt{/usr}"
{\footnotesize{
\begin{scripti}
\fprompt{~/program-1.2.12} \bftt{./configure} \dgtt{--prefix=/usr}
\fprompt{~/program-1.2.12} \bftt{make}
\end{scripti}
}}
\item Create an "\texttt{AppDir}" directory to install the program using the \bftt{DESTDIR} variable: 
{\footnotesize{
\begin{scripti}
\fprompt{~/program-1.2.12} \bftt{mkdir} \dgtt{AppDir}
\fprompt{~/program-1.2.12} \bftt{make} \dgtt{install} \rtt{DESTDIR}=\dvar{PWD}"/AppDir"
\end{scripti}
}}
\item Prepare you \abuild\ recipe, in a file named "\texttt{program.yml}" 
{\footnotesize{
\begin{scripti}
\comm{appimage-builder recipe, for details see:}
\comm{\href{https://appimage-builder.readthedocs.io}{https://appimage-builder.readthedocs.io}}
\yml{version} \magenta{1}
\yml{AppDir}
  \yml{path} ./AppDir
  \yml{app\_info}
    \yml{id} program     \comm{Name of the .desktop file}
    \yml{name} program   \comm{Name of the program}
    \yml{icon} program   \comm{Name of the icon file, no extention required}
    \yml{version} \magenta{1.2.12}
    \yml{exec} usr/bin/program
    \yml{exec\_args} \$@
  \yml{test}
    \yml{fedora}
      \yml{image} appimagecrafters/tests-envfedora-30
      \yml{command} ./AppRun
      \yml{use\_host\_x} True
    \yml{debian}
      \yml{image} appimagecrafters/tests-envdebian-stable
      \yml{command} ./AppRun
      \yml{use\_host\_x} True
\yml{AppImage}
  \yml{arch} x86\_64
  \yml{update-information} guess
\end{scripti}
}}
\end{itemize}

\newpage
\subsubsection*{Recipe using packages from official Debian repositories}

\begin{itemize}
\item Prepare you \abuild\ recipe, in a file named "\texttt{program.yml}" 
{\notsoscript{
\begin{scripti}
\comm{appimage-builder recipe, for details see:}
\comm{\href{https://appimage-builder.readthedocs.io}{https://appimage-builder.readthedocs.io}}
\yml{version} \magenta{1}
\yml{AppDir}
  \yml{path} ./AppDir
  \yml{app\_info}
    \yml{id} program     \comm{Name of the .desktop file}
    \yml{name} program   \comm{Name of the program}
    \yml{icon} program   \comm{Name of the icon file, no extention required}
    \yml{version} \magenta{1.2.12}
    \yml{exec} usr/bin/program 
    \yml{exec\_args} \$@
  \yml{apt}
    \yml{arch} amd64
    \yml{sources}
      \bbtt{-} \yml{sourceline} \magenta{'deb [arch=amd64, signed-by=/usr/share/keyrings/debian-archive-bookworm-automatic.gpg] 
                          http://deb.debian.org/debian bookworm-backports main'}
      \bbtt{-} \yml{sourceline} \magenta{'deb [arch=amd64, signed-by=/usr/share/keyrings/debian-archive-bookworm-automatic.gpg] 
                          http://deb.debian.org/debian bookworm main'}
    \comm{Package and dependencies to be included:}
    \yml{include}
      \bbtt{-} program
      \bbtt{-} program-data
      \bbtt{-} libgtk-3-0
      \bbtt{-} libxml2
      \bbtt{-} libpangoft2-1.0-0
      \bbtt{-} libglu1-mesa
      \bbtt{-} libepoxy0
      \bbtt{-} libavutil57
      \bbtt{-} libavcodec59
      \bbtt{-} libavformat59
      \bbtt{-} libswscale6
\yml{AppImage}
  \yml{arch} x86\_64
  \yml{update-information} guess
\end{scripti}
}}
\end{itemize}
The \yml{apt} section describes packages to be downloaded using the \bftt{apt} command, therefore this recipe file is for Debian based Linux. 



\subsubsection*{Build the appimage using \abuild\ and the recipe}

{\footnotesize{
\begin{script}
\fprompt{~/program-1.2.12} \abuild \dgtt{--recipe} \rtt{program.yml}
\end{script}
}}

\newpage
\subsection{\pbuild}

{\em{Note: same issue as before, only the local build is wokring so far, no way to use the on-line repositories because of the GPG key issue.}}

\begin{itemize}
\item Prepare you \pbuild\ recipe, in a file named "\texttt{prog.yml}"
{\notsoscript{
\begin{scripti}
\yml{app} program
\yml{binpatch} true

\yml{ingredients}
  \yml{dist} bookworm-backports
\comm{Either retreive the package from an official Debian repository ...}
  \yml{sources}
    \bbtt{-} \yml{sourceline} \magenta{'deb [arch=amd64, signed-by=/usr/share/keyrings/debian-archive-bookworm-automatic.gpg]
                                            http://deb.debian.org/debian bookworm-backports main'}
    \bbtt{-} \yml{sourceline} \magenta{'deb [arch=amd64, signed-by=/usr/share/keyrings/debian-archive-bookworm-automatic.gpg]
                                            http://deb.debian.org/debian bookworm main'}

    \bbtt{-} deb http//ftp.fr.debian.org/debian/ bookworm-backports main 
\comm{... or select local .deb files using complete file path}
  \yml{debs}
    \bbtt{-} /home/user/files/git-files/program/program_1.2.12-1_amd64.deb
    \bbtt{-} /home/user/files/git-files/program/prog-data_1.2.12-1_all.deb
  \yml{packages}
    \bbtt{-} program
    \bbtt{-} prgram-data
    \bbtt{-} program
    \bbtt{-} program-data
    \bbtt{-} libgtk-3-0
    \bbtt{-} libxml2
    \bbtt{-} libpangoft2-1.0-0
    \bbtt{-} libglu1-mesa
    \bbtt{-} libepoxy0
    \bbtt{-} libavutil57
    \bbtt{-} libavcodec59
    \bbtt{-} libavformat59
    \bbtt{-} libswscale6
  \yml{script}
    \bbtt{-} ls ../program_*deb|sed 's/..\/program_//1' | cut -d "-" -f 1 > ../VERSION
    \bbtt{-} cp usr/share/pixmaps/program.svg .
\end{scripti}
}}
\item Put the "\texttt{prog.yml}" file in a "\texttt{recipes}" folder
{\footnotesize{
\begin{scripti}
\fprompt{~/program-1.2.12} \bftt{mkdir} recipes
\fprompt{~/program-1.2.12} \bftt{mv} \rtt{prog.yml} recipes/
\end{scripti}
}}
\item Build the appimage using \pbuild\ and the recipe
{\footnotesize{
\begin{scripti}
\fprompt{~/program-1.2.12} \pbuild \rtt{recipes/prog.yml}
\end{scripti}
}}
\end{itemize}
